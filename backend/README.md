# Backend — FastAPI

## Stack

- **FastAPI** — REST API
- **XGBoost** — price prediction model
- **Pandas** — data handling
- **Pydantic** — response validation

## Structure

```
backend/
├── main.py              Entry point
├── ml.py                ML utilities (estimate, comps)
├── train_model.py       Model training script
├── data_cleaner.py      Data cleaning pipeline
├── extractors.py        Feature extraction helpers
├── app/
│   ├── config.py        Paths, CORS, constants
│   ├── data/loader.py   DataFrame + model singleton
│   ├── routers/         One file per endpoint group
│   ├── schemas/         Pydantic models
│   └── services/        Business logic
├── data/
│   ├── house_price.json Raw dataset (not in git)
│   └── final_data.json  Generated by train_model.py
├── model/
│   ├── model.joblib     Generated by train_model.py
│   └── scaler.joblib    Generated by train_model.py
└── tests/
```

## Setup

```bash
# Create and activate virtual environment
python -m venv ml-env
source ml-env/bin/activate

# Install dependencies
pip install -r requirements.txt
```

## Train the model

Required before first run. Reads `data/house_price.json`, outputs `data/final_data.json` + `model/model.joblib`.

```bash
python train_model.py
```

## Run

```bash
uvicorn main:app --reload --port 8000
```

## API Endpoints

| Method | Path | Description |
|--------|------|-------------|
| GET | `/listings` | Paginated + filtered listings |
| GET | `/listings/{id}` | Single listing detail |
| GET | `/listings/{id}/estimate` | ML price estimate |
| GET | `/listings/{id}/comps` | 5 comparable listings |
| GET | `/market/insights` | Price stats by neighborhood |
| GET | `/filters/options` | Available filter values |
| GET | `/health` | API status |

Interactive docs available at **http://127.0.0.1:8000/docs**

## Run Tests

```bash
pytest
```